
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Lab &#34;Batch Ingestion: Ingest RDBMS Source with Sqoop&#34;</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="None"
                  id="batch_ingestion_sqoop"
                  title="Lab &#34;Batch Ingestion: Ingest RDBMS Source with Sqoop&#34;"
                  environment="web"
                  feedback-link="https://p-kueppers.com">
    
      <google-codelab-step label="Introduction" duration="0">
        <p>In this use case we want to store the contents of our webshop table in the data lake (nightly full extract).</p>
<p class="image-container"><img style="width: 624.00px" src="img\\1eca3258eb5436c9.png"></p>
<h3 is-upgraded><strong>Goal</strong></h3>
<p>Ingesting structured relational data into the data lake for batch processing via a (horizontally) scalable sqoop (MapReduce) job.</p>
<h2 is-upgraded><strong>What you&#39;ll implement</strong></h2>
<ul>
<li>Set up a DataProc cluster which is capable of executing the sqoop job and act as a data lake (HDFS).</li>
<li>Learn about initialization actions for Hadoop DataProc clusters and especially use the sqoop initialization action.</li>
<li>Start a sqoop job to transfer data from SQL to the data lake (HDFS-based and cloud storage)</li>
</ul>
<aside class="warning"><p><strong>Please note:</strong> You&#39;ll need GCP access for this lab. The provided voucher needs to be redeemed. Remember to shut down the running cloud function after completing!</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Setting up the Hadoop DataProc Cluster" duration="7">
        <h2 is-upgraded><strong>Creating the DataProc cluster </strong></h2>
<p>Please configure a cluster (enable Jupyter Notebook, select compute family &#34;N2&#34; with standard persistent disks limited to 50GB for worker and master nodes). <strong>Do not hit create, since we&#39;ll need a further step!</strong></p>
<p>We&#39;ll need to activate the sqoop initialization action, which is not selectable via the WebUI. Thus, please click &#34;Equivalent Command Line&#34; and copy/paste the CLI call for cluster creation in a text editor:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\39b41cb5f61b1115.png"></p>
<p>We&#39;ll need to add the following CLI arguments, in order to install sqoop on the master and worker nodes:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\5525d562c232cf7f.png"></p>
<p>This is the initialization action that needs to be added:</p>
<pre><code> --initialization-actions gs://goog-dataproc-initialization-actions-us-central1/sqoop/sqoop.sh</code></pre>
<p>Please open the GCP Cloud Shell (top right in the web console) and insert the cluster creation command there:</p>
<p class="image-container"><img style="width: 293.00px" src="img\\9a2028815601d75f.png"></p>
<p class="image-container"><img style="width: 624.00px" src="img\\290a17746baddc8e.png"></p>
<p>Cluster creation will take some minutes.</p>
<p>When cluster creation is finished, you can select the cluster in the web UI:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\a80f5f7db4d71775.png"></p>
<p>Open a connection to the master node which is able to start sqoop jobs:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\5f8b49055e3e4dfb.png"></p>
<h2 is-upgraded><strong>Results</strong></h2>
<ol type="1" start="1">
<li>You created a Hadoop cluster (DataProc) as well as the sqoop component for batch ingestion of relational data into our data lake.</li>
<li>You learned how to set up a DataProc cluster via the cloud shell.</li>
<li>Next, we&#39;ll use the connection to the master node and execute our sqoop data ingestion job.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Creating the Sqoop Ingestion Job" duration="4">
        <h2 is-upgraded><strong>Executing the job (with HDFS import)</strong></h2>
<p>Please open the SSH connection to the master node.</p>
<p>The following command starts the sqoop job (the &#34;--m 1&#34; option is necessary since there is no primary key defined on our table).</p>
<pre><code>sqoop import --connect jdbc:mysql://&lt;db-IP see Moodle&gt;/&lt;dbname, see Moodle&gt; --userna
me &lt;see Moodle&gt; --password &lt;see Moodle&gt; --table sales --m 1</code></pre>
<p>You now should see a lot of output since a MapReduce (horizontally scaling!) job is running and retrieving the data from the relational database.</p>
<p>When finished, the output should look like this:</p>
<h2 is-upgraded><img style="width: 624.00px" src="img\\42c50b23861edf94.png"></h2>
<p>We ingested 30 rows into our data lake.</p>
<h2 is-upgraded><strong>Checking the results</strong></h2>
<p>The sqoop job puts its data into HDFS by default (it is a &#34;traditional&#34; tool). You can check this by executing the following command on the master node:</p>
<pre><code>hadoop fs -ls</code></pre>
<p>This will show one folder &#34;sales&#34;. We can take a look into this folder with this command:</p>
<pre><code>hadoop fs -ls sales/</code></pre>
<p>With this command you&#39;ll be able to take a look at the data being extracted from the RDBMS:</p>
<pre><code>hadoop fs -cat sales/part-m-00000</code></pre>
<p>This should be the output:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\6ac27ae8ae569662.png"></p>
<h2 is-upgraded><strong>Executing the job (with GCS import)</strong></h2>
<p>In order to import the relational data into our GCS-based data lake, we need to set the target directory explicitly to avoid HDFS. This command will ingest the input from our database into a GCS bucket (pk-gcs) and therein a folder &#34;sales_from_sqoop&#34; (make sure to change your initials if applicable):</p>
<pre><code>sqoop import --connect jdbc:mysql://&lt;db-IP see Moodle&gt;/&lt;dbname, see Moodle&gt; --userna
me &lt;see Moodle&gt; --password &lt;see Moodle&gt; --table sales --m 1 --target-dir gs://hdm-kueppers/sales_from_sqoop</code></pre>
<p>This should yield the same shell output, however your GCS bucket should now contain folder &#34;sales_from_sqoop&#34;:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\d24810c5071ee266.png"></p>
<p>The folder contains the same files as the HDFS folder sqoop created in our first job run.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\b05b9ae3b259c4de.png"></p>
<p>We could set an autoscaling policy to let our DataProc cluster scale-up if necessary:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\2fa7ee55facef7f0.png"></p>
<p>This is, however, not part of our lecture.</p>
<h2 is-upgraded><strong>Results</strong></h2>
<ol type="1" start="1">
<li>You executed a sqoop (MapReduce) job with different configurations (HDFS output first and GCS output second).</li>
<li>This setup is big data ready for heavy workloads, since MapReduce is capable of scaling out (horizontally) and if necessary, you can add worker nodes to your cluster (however, the SQL database might become a bottleneck).</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Cleaning Up" duration="2">
        <p>If you <strong>won&#39;t continue </strong>with the next lab (which is recommended), please make sure to delete your cluster:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\be443522e927f2d8.png"></p>
<p>You may also want to clean up your GCS bucket. However, especially in the live lecture please leave the files in place.</p>
<h2 is-upgraded><strong>Results</strong></h2>
<ol type="1" start="1">
<li>You finished the lab and performed all necessary clean-up tasks.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Congratulations" duration="2">
        <p>Congratulations, you set up a &#34;big data-traditional&#34; and horizontally scaling ingestion pipeline using a Hadoop cluster with sqoop. You learned about initialization actions which come in handy when working with DataProc.</p>
<aside class="special"><p><strong>Please note: </strong>You can now close this lab.</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
